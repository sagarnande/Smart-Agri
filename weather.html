<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Weather</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/logo.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Marcellus:wght@400&display=swap"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <style>
    .container1 {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .container1 h1 {
      font-size: 32px;
    }

    .whyproduct {
      text-align: center;
      margin: 55px;
      padding-left: 100px;
      padding-right: 100px;
    }

    #weatherInfo {
      padding: 30px;
    }

    #weatherInfo h3 {
      font-size: 28px;
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      padding-bottom: 20px;
    }

    #weatherInfo p {
      font-size: 15px;
      padding-left: 23px;
    }

    .cohereAdvice {
      max-width: 900px;
      padding: 20px;
      min-height: 150px;
    }

    #cohereAdvice h3 {
      font-size: 28px;
      padding-bottom: 20px;
    }

    #cohereAdvice p {
      font-size: 18px;
      padding-left: 25px;
    }

    #cohereAdvice {
      padding-left: 100px;
      padding-right: 100px;
      padding-bottom: 30px;
    }

    .buttons {
      margin-bottom: 20px;
      color: #ccc;
    }

    .search-container {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
     
    .suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      width: 100%;
      max-width: 600px;
      z-index: 1000;
      margin-top: 40px;
    }

    .suggestions div {
      padding: 10px;
      cursor: pointer;
    }

    .suggestions div:hover {
      background: #f0f0f0;
    }
    /* Button Styles */
button {
  background-color: #007bff; /* Primary color */
  color: white; /* Text color */
  border: none; /* Remove default border */
  border-radius: 5px; /* Rounded corners */
  padding: 10px 20px; /* Padding for button */
  font-size: 16px; /* Font size */
  cursor: pointer; /* Pointer cursor on hover */
  transition: background-color 0.3s ease, transform 0.2s ease; /* Smooth transition */
}

button:hover {
  background-color: #0056b3; /* Darker shade on hover */
  transform: translateY(-2px); /* Slight lift effect */
}

button:active {
  transform: translateY(0); /* Reset lift effect on click */
}

button:disabled {
  background-color: #ccc; /* Grey background for disabled state */
  cursor: not-allowed; /* Not-allowed cursor */
}
  </style>
</head>

<body class="about-page">
  <header id="header" class="header d-flex align-items-center position-relative">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="AgriCulture">
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="{{ url_for('home') }}">Home</a></li>
          <li><a href="{{ url_for('products') }}">Products</a></li>
          <li><a href="{{ url_for('services') }}">Our Services</a></li>
          <li><a href="{{ url_for('contact') }}">Contact</a></li>
          <li><a href="{{ url_for('login') }}">Log in</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
    </div>
  </header>
  <main class="main">
    <!-- Page Title -->
    <div class="page-title dark-background" data-aos="fade" style="background-image: url(assets/img/weather.png);">
      <div class="container position-relative">
        <h1>Weather Alerts</h1>
        <p>Real-time weather updates for farmers</p>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li class="current">About</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <div class="whyproduct">
      <h2 class="content-title mb-4">Provide the weather and its relatable advice to farmers</h2>
      <p class="mb-4">
        Supporting farmers with quality products is crucial for agricultural success. Modern tools, high-quality
        seeds, fertilizers, and advanced machinery help farmers increase productivity, reduce labor, and enhance
        crop quality. Sustainable farming products also ensure long-term environmental health while boosting
        profitability.
        By equipping farmers with the right resources, we contribute to food security and economic growth.
      </p>
    </div>

    <div class="container1">
      <h1>Current Weather Conditions & Advice</h1>
    </div>
    <div class="container1">
      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search for your village:"
          autocomplete="off">
        <button id="searchLocation">Search Location</button>
      </div>
      <div id="suggestions" class="suggestions"></div>
      <div class="buttons">
        <button id="getCurrentLocation">Use My Location</button>
      </div>

      <div id="weatherInfo"></div>
    </div>

    <div id="cohereAdvice" class="cohere-advice"></div>
  </main>
<script>
  const WEATHER_API_KEY = '56841465d48b16e3d2cbf3542223bd81';
const COHERE_API_KEY = 'riyXcV8DUJGIskppNKAW9wtAg1MK21PixI3kOiSs'; // Replace with your Cohere API key

const weatherInfo = document.getElementById('weatherInfo');
const cohereAdvice = document.getElementById('cohereAdvice');
const getCurrentLocation = document.getElementById('getCurrentLocation');
const searchInput = document.getElementById('searchInput');
const searchLocation = document.getElementById('searchLocation');
const suggestionsBox = document.getElementById('suggestions');

// Debounce function to limit API calls during input
function debounce(func, delay) {
    let timeout;
    return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), delay);
    };
}

// Function to fetch weather data by coordinates
async function getWeatherData(lat, lon) {
    showLoading();
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`);
        if (!response.ok) throw new Error('Weather data not available');
        const data = await response.json();
        displayWeatherInfo(data);
        const advice = await getCohereAdvice(data);
        displayCohereAdvice(advice);
    } catch (error) {
        showError('Unable to fetch weather data. Please try again.');
    }
}

// Function to fetch weather data by location name
async function getWeatherDataByLocation(location) {
    showLoading();
    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${location}&appid=${WEATHER_API_KEY}&units=metric`);
        if (!response.ok) throw new Error('Weather data not available');
        const data = await response.json();
        displayWeatherInfo(data);
        const advice = await getCohereAdvice(data);
        displayCohereAdvice(advice);
    } catch (error) {
        showError('Unable to fetch weather data. Please try again.');
    }
}

// Function to get farming advice from Cohere API
async function getCohereAdvice(weatherData) {
    const prompt = `Provide farming advice for the following weather conditions: Weather: ${weatherData.weather[0].description}, Temperature: ${weatherData.main.temp}°C, Humidity: ${weatherData.main.humidity}%, Wind Speed: ${weatherData.wind.speed} m/s.`;
    try {
        const response = await fetch('https://api.cohere.ai/v1/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${COHERE_API_KEY}`
            },
            body: JSON.stringify({
                model: 'command-r-08-2024',
                message: prompt,
                temperature: 0.7,
                chat_history: [],
                prompt_truncation: 'AUTO'
            })
        });
        if (!response.ok) throw new Error('Failed to fetch advice from Cohere API');
        const data = await response.json();
        return data.text; // Assuming the response contains a 'text' field with the advice
    } catch (error) {
        console.error('Cohere API error:', error);
        return 'Unable to fetch farming advice. Please try again.';
    }
}

// Function to display weather information
function displayWeatherInfo(weather) {
    const { main, weather: conditions, wind, name } = weather;
    weatherInfo.innerHTML = `
        <h3>Weather Information</h3>
        <p><strong>City:</strong> ${name}</p>
        <p><strong>Temperature:</strong> ${main.temp.toFixed(1)}°C</p>
        <p><strong>Weather:</strong> ${conditions[0].main} - ${conditions[0].description}</p>
        <p><strong>Humidity:</strong> ${main.humidity}%</p>
        <p><strong>Wind Speed:</strong> ${wind.speed.toFixed(1)} m/s</p>
    `;
}

// Function to display Cohere advice
function displayCohereAdvice(advice) {
    cohereAdvice.innerHTML = `
        <h3>Farming Advice:</h3>
        <p>${formatResponse(advice)}</p>
    `;
}

// Function to format the response for better readability
function formatResponse(response) {
    let formattedResponse = response.replace(/\n/g, '<br>');
    formattedResponse = formattedResponse.replace(/•/g, '<li>').replace(/(<li>.*?<\/li>)/g, '<ul>$1</ul>');
    formattedResponse = formattedResponse.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
    return formattedResponse;
}

// Function to show loading state
function showLoading() {
    weatherInfo.innerHTML = '<div class="loading">Loading weather information...</div>';
    cohereAdvice.innerHTML = '<div class="loading">Fetching farming advice...</div>';
}

// Function to show error message
function showError(message) {
    weatherInfo.innerHTML = `<p class="error">${message}</p>`;
    cohereAdvice.innerHTML = ''; // Clear advice section on error
}

// Event listener for "Use My Location" button
getCurrentLocation.addEventListener('click', () => {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const { latitude, longitude } = position.coords;
            getWeatherData(latitude, longitude);
        }, () => {
            showError('Geolocation failed. Please enable location access.');
        });
    } else {
        showError('Geolocation is not supported by your browser.');
    }
});

// Event listener for "Search Location" button
searchLocation.addEventListener('click', () => {
    const location = searchInput.value.trim();
    if (location) {
        getWeatherDataByLocation(location);
    } else {
        showError('Please enter a location.');
    }
});

// Debounced input event listener for suggestions
searchInput.addEventListener('input', debounce(async (e) => {
    const query = e.target.value.trim();
    if (query.length > 2) {
        try {
            const response = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=5&appid=${WEATHER_API_KEY}`);
            const data = await response.json();
            showSuggestions(data);
        } catch (error) {
            console.error('Error fetching suggestions:', error);
        }
    } else {
        suggestionsBox.innerHTML = '';
    }
}, 300));

// Function to show suggestions
function showSuggestions(data) {
    suggestionsBox.innerHTML = data.map(item => `
        <div onclick="selectSuggestion('${item.name}, ${item.country}')">${item.name}, ${item.country}</div>
    `).join('');
}

// Function to handle suggestion selection
window.selectSuggestion = function (location) {
    searchInput.value = location;
    suggestionsBox.innerHTML = '';
    getWeatherDataByLocation(location);
};
</script>

<footer id="footer" class="footer dark-background">

  <div class="footer-top">
      <div class="container">
          <div class="row gy-4">
              <div class="col-lg-4 col-md-6 footer-about">
                  <a href="index.html" class="logo d-flex align-items-center">
                      <span class="sitename">AgriCulture</span>
                  </a>
                  <div class="footer-contact pt-3">
                      <p>A108 Adam Street</p>
                      <p>New York, NY 535022</p>
                      <p class="mt-3"><strong>Phone:</strong> <span>+1 5589 55488 55</span></p>
                      <p><strong>Email:</strong> <span>info@example.com</span></p>
                  </div>
              </div>

              <div class="col-lg-2 col-md-3 footer-links">
                  <h4>Useful Links</h4>
                  <ul>
                      <li><a href="#">Home</a></li>
                      <li><a href="#">About us</a></li>
                      <li><a href="#">Services</a></li>
                      <li><a href="#">Terms of service</a></li>
                      <li><a href="#">Privacy policy</a></li>
                  </ul>
              </div>

              <div class="col-lg-2 col-md-3 footer-links">
                  <h4>Our Services</h4>
                  <ul>
                      <li><a href="#">Web Design</a></li>
                      <li><a href="#">Web Development</a></li>
                      <li><a href="#">Product Management</a></li>
                      <li><a href="#">Marketing</a></li>
                      <li><a href="#">Graphic Design</a></li>
                  </ul>
              </div>

              <div class="col-lg-2 col-md-3 footer-links">
                  <h4>Hic solutasetp</h4>
                  <ul>
                      <li><a href="#">Molestiae accusamus iure</a></li>
                      <li><a href="#">Excepturi dignissimos</a></li>
                      <li><a href="#">Suscipit distinctio</a></li>
                      <li><a href="#">Dilecta</a></li>
                      <li><a href="#">Sit quas consectetur</a></li>
                  </ul>
              </div>

              <div class="col-lg-2 col-md-3 footer-links">
                  <h4>Nobis illum</h4>
                  <ul>
                      <li><a href="#">Ipsam</a></li>
                      <li><a href="#">Laudantium dolorum</a></li>
                      <li><a href="#">Dinera</a></li>
                      <li><a href="#">Trodelas</a></li>
                      <li><a href="#">Flexo</a></li>
                  </ul>
              </div>

          </div>
      </div>
  </div>

  <div class="copyright text-center">
      <div
          class="container d-flex flex-column flex-lg-row justify-content-center justify-content-lg-between align-items-center">

          <div class="d-flex flex-column align-items-center align-items-lg-start">
              <div>
                  © Copyright <strong><span>MyWebsite</span></strong>. All Rights Reserved
              </div>
              <div class="credits">
                  <!-- All the links in the footer should remain intact. -->
                  <!-- You can delete the links only if you purchased the pro version. -->
                  <!-- Licensing information: https://bootstrapmade.com/license/ -->
                  <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/herobiz-bootstrap-business-template/ -->
                  Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
              </div>
          </div>

          <div class="social-links order-first order-lg-last mb-3 mb-lg-0">
              <a href=""><i class="bi bi-twitter-x"></i></a>
              <a href=""><i class="bi bi-facebook"></i></a>
              <a href=""><i class="bi bi-instagram"></i></a>
              <a href=""><i class="bi bi-linkedin"></i></a>
          </div>

      </div>
  </div>

</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>

<!-- Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>